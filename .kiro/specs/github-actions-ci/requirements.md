# Requirements Document

## Introduction

S3 Tables CLI (s3t) プロジェクトに GitHub Actions を利用した CI（継続的インテグレーション）パイプラインを導入する。コードの品質、セキュリティ、一貫性を自動的に検証し、開発プロセスの信頼性を向上させる。

## Glossary

- **CI_Workflow**: GitHub Actions で定義される CI パイプライン全体
- **Test_Job**: Go テストを実行するジョブ
- **Build_Job**: Go ビルドを実行するジョブ
- **Lint_Job**: 静的解析を実行するジョブ
- **Format_Checker**: コードフォーマットを検証するコンポーネント
- **Dependency_Checker**: 依存関係の整合性を検証するコンポーネント
- **Security_Scanner**: セキュリティ脆弱性をスキャンするコンポーネント
- **Coverage_Reporter**: コードカバレッジをレポートするコンポーネント

## Requirements

### Requirement 1: CI ワークフロートリガー

**User Story:** As a developer, I want CI to run automatically on code changes, so that I can catch issues early in the development process.

#### Acceptance Criteria

1. WHEN a push is made to the main branch, THE CI_Workflow SHALL execute all CI jobs
2. WHEN a pull request is opened or updated against any branch, THE CI_Workflow SHALL execute all CI jobs
3. THE CI_Workflow SHALL use Go version 1.25.x as specified in go.mod

### Requirement 2: テスト実行

**User Story:** As a developer, I want automated tests to run on every change, so that I can ensure code correctness and detect regressions.

#### Acceptance Criteria

1. WHEN the CI_Workflow executes, THE Test_Job SHALL run all tests in all packages using `go test ./...`
2. THE Test_Job SHALL enable race condition detection using the `-race` flag
3. THE Test_Job SHALL generate a coverage profile using `-coverprofile=coverage.out`
4. THE Test_Job SHALL output verbose test results using the `-v` flag

### Requirement 3: ビルド検証

**User Story:** As a developer, I want the build to be verified automatically, so that I can ensure the code compiles correctly.

#### Acceptance Criteria

1. WHEN the CI_Workflow executes, THE Build_Job SHALL build all packages using `go build ./...`
2. THE Build_Job SHALL output verbose build information using the `-v` flag

### Requirement 4: 静的解析（Lint）

**User Story:** As a developer, I want static analysis to run automatically, so that I can maintain code quality and catch potential issues.

#### Acceptance Criteria

1. WHEN the CI_Workflow executes, THE Lint_Job SHALL run golangci-lint
2. THE Lint_Job SHALL use a configuration file `.golangci.yml` for lint rules

### Requirement 5: フォーマットチェック

**User Story:** As a developer, I want code formatting to be verified automatically, so that I can maintain consistent code style.

#### Acceptance Criteria

1. WHEN the CI_Workflow executes, THE Format_Checker SHALL verify that all Go files are formatted with gofmt
2. WHEN the CI_Workflow executes, THE Format_Checker SHALL verify that all Go imports are organized with goimports
3. IF any file is not properly formatted, THEN THE Format_Checker SHALL fail the CI workflow

### Requirement 6: 依存関係チェック

**User Story:** As a developer, I want dependency integrity to be verified automatically, so that I can ensure reproducible builds.

#### Acceptance Criteria

1. WHEN the CI_Workflow executes, THE Dependency_Checker SHALL verify module integrity using `go mod verify`
2. WHEN the CI_Workflow executes, THE Dependency_Checker SHALL verify that go.mod and go.sum are up to date using `go mod tidy`
3. IF go.mod or go.sum would be modified by `go mod tidy`, THEN THE Dependency_Checker SHALL fail the CI workflow

### Requirement 7: セキュリティスキャン

**User Story:** As a developer, I want security vulnerabilities to be detected automatically, so that I can address security issues promptly.

#### Acceptance Criteria

1. WHEN the CI_Workflow executes, THE Security_Scanner SHALL scan for known vulnerabilities using govulncheck
2. IF vulnerabilities are detected, THEN THE Security_Scanner SHALL report them in the CI output

### Requirement 8: コードカバレッジレポート

**User Story:** As a developer, I want to see code coverage metrics, so that I can understand test coverage and identify untested code.

#### Acceptance Criteria

1. WHEN tests complete successfully, THE Coverage_Reporter SHALL display function-level coverage using `go tool cover -func`
2. THE Coverage_Reporter SHALL use the coverage profile generated by the Test_Job
